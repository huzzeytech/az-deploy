,
          {
            "apiVersion": "2015-06-15",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "name": "[concat(variables('caname'), '/joindomain')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachines/', variables('caname'), '/extensions/createdomain')]"
            ],
            "properties": {
              "publisher": "Microsoft.Compute",
              "type": "JsonADDomainExtension",
              "typeHandlerVersion": "1.3",
              "autoUpgradeMinorVersion": true,
              "settings": {
                "Name": "[variables('domainname')]",
                "OUPath": "[concat('OU=Computers;', ' DC=', variables('domainname'), '\\')]",
                "User": "[concat(variables('domainname'), '\\', parameters('adminUsername'))]",
                "Restart": "true",
                "Options": "3"
              },
              "protectedSettings": {
                "Password": "[parameters('adminPassword')]"
              }
            }
          },
          {
            "apiVersion": "2018-06-01",
            "name": "[concat(variables('caname'), '/createca')]",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachines/', variables('caname'))]"
            ],
            "tags": {
                "displayName": "initialize-ca"
            },
            "properties": {
                "publisher": "Microsoft.Compute",
                "type": "CustomScriptExtension",
                "typeHandlerVersion": "1.9",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "fileUris": [
                        "https://raw.githubusercontent.com/huzzeytech/az-deploy/master/scripts/init-ca.ps1"
                    ]
                },
                "protectedSettings": {
                    "commandToExecute": "[concat('powershell -ExecutionPolicy Unrestricted -File ', variables('cascriptFileName'), ' ', variables('cascriptParameters'))]"
                }
            }
        },
        {
            "apiVersion": "2015-06-15",
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "name": "[concat(variables('clientname'), '/joindomain')]",
            "location": "[parameters('location')]",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachines/', variables('vmname'), '/extensions/createdomain')]"
            ],
            "properties": {
              "publisher": "Microsoft.Compute",
              "type": "JsonADDomainExtension",
              "typeHandlerVersion": "1.3",
              "autoUpgradeMinorVersion": true,
              "settings": {
                "Name": "[variables('domainname')]",
                "OUPath": "",
                "User": "[concat(variables('domainname'), '\\', parameters('adminUsername'))]",
                "Restart": "true",
                "Options": "3"
              },
              "protectedSettings": {
                "Password": "[parameters('adminPassword')]"
              }
            }
          }